%pre
exec < /dev/tty6 > /dev/tty6 2> /dev/tty6
chvt 6
echo "Starting of installation with kickstart v0.07 ..."
chvt 1
exec < /dev/tty1 > /dev/tty1 2> /dev/tty1
%end
# System authorization information
auth --enableshadow --passalgo=sha512
reboot
# Use netwok installation
#url --url="http://ftp.halifax.rwth-aachen.de/fedora/linux/releases/25/Everything/x86_64/os/"
#url --url="https://www.mirrorservice.org/sites/dl.fedoraproject.org/pub/fedora/linux/releases/25/Everything/x86_64/os/"
# Use graphical install
graphical
#text
# Run the Setup Agent on first boot
firstboot --enable
# Keyboard layouts
keyboard --vckeymap=pt --xlayouts='pt'
# System language
lang en_GB.UTF-8 --addsupport=de_DE.UTF-8,es_ES.UTF-8,fr_FR.UTF-8,pt_PT.UTF-8
# Network information
network  --bootproto=dhcp --device=ens3 --ipv6=auto --activate --hostname=fedora
# Root password
# System services
services --enabled="chronyd"
# System timezone
#timezone Europe/Berlin --isUtc
# X Window System configuration information
xconfig  --startxonboot
# System bootloader configuration
#bootloader --location=mbr --boot-drive=sda
# Partition clearing information
#clearpart --initlabel --drives=sda --all
# Disk partitioning information


%post
exec < /dev/tty3 > /dev/tty3
chvt 3
echo "################################"
echo "# Running Post Configuration   #"
echo "################################"
echo 'Setting delta rpm...'
echo "deltarpm=1" | sudo tee -a /etc/dnf/dnf.conf

echo 'Updating system...'
dnf update -y

echo 'Setting repositories...'
echo 'Setting Spotify repository...'
#Spotify
dnf config-manager --add-repo=http://negativo17.org/repos/fedora-spotify.repo
echo 'Setting Skype repository...'
# Skype
dnf config-manager --add-repo=http://negativo17.org/repos/fedora-skype.repo
echo 'Setting Flash repository...'
# Flash
dnf config-manager --add-repo=http://negativo17.org/repos/fedora-flash-plugin.repo
echo 'Setting general multimedia repository...'
# Multimedia
dnf config-manager --add-repo=http://negativo17.org/repos/fedora-multimedia.repo

echo 'Installing rpmfusion...'
dnf install -y "https://download1.rpmfusion.org/free/fedora/rpmfusion-free-release-$(rpm -E %fedora).noarch.rpm"
dnf install -y "https://download1.rpmfusion.org/nonfree/fedora/rpmfusion-nonfree-release-$(rpm -E %fedora).noarch.rpm"
echo 'Installing GitHub Atom editor...'
dnf install -y "https://github.com/atom/atom/releases/download/v1.11.1/atom.x86_64.rpm"

echo 'Updating system...'
dnf update -y

echo 'Installing big list of packages...'
dnf install -y tmux \
docker-vim vim-enhanced vim-common vim-filesystem \
git python-pip perl-core spotify-client vlc \
java-openjdk icedtea-web unzip chromium skype \
flash-plugin libdvdcss deltarpm powertop skanlite \
gimp inkscape setroubleshoot nmap ntfs-3g w3m \
youtube-dl lynx cups cups-filters ghostscript \
hplip hpijs nss-mdns fortune-mod cowsay powerline \
tmux-powerline vim-plugin-powerline \
dejavu-sans-mono-fonts google-droid-sans-mono-fonts \
mozilla-fira-mono-fonts levien-inconsolata-fonts

echo 'Downloading hplip and lastpass for later install...'
mkdir /home/jgorgulho/toInstall
wget -O hplip.run "http://downloads.sourceforge.net/project/hplip/hplip/3.16.11/hplip-3.16.11.run?r=http%3A%2F%2Fhplipopensource.com%2Fhplip-web%2Finstall%2Finstall%2Findex.html&ts=1480467242&use_mirror=netassist"
wget -O lastpass.tar.bz2 "https://lastpass.com/lplinux.tar.bz2"
echo 'Moving hplip and lastpass to user folder...'
mv hplip.run /home/jgorgulho/toInstall
mv lastpass.tar.bz2 /home/jgorgulho/toInstall
chown -R jgorgulho /home/jgorgulho/toInstall
chown -R jgorgulho /home/jgorgulho/toInstall/*

echo "Cloning dotfiles from github repo to root..."
git clone https://github.com/jgorgulho/dotfiles /root/.dotfiles
ln -sf /root/.dotfiles/.bashrc /root/.bashrc
echo "Cloning dotfiles from github repo to user..."
git clone https://github.com/jgorgulho/dotfiles /home/jgorgulho/.dotfiles
ln -sf /home/jgorgulho/.dotfiles/.bashrc /home/jgorgulho/.bashrc
chown -R jgorgulho /home/jgorgulho/.dotfiles
chown -R jgorgulho /home/jgorgulho/.dotfiles/.*
chown -R jgorgulho /home/jgorgulho/.bashrc

echo "Installing Jekyll..."
gem install jekyll

echo "Installing docker compose..."
curl -L "https://github.com/docker/compose/releases/download/1.9.0/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
chmod +x /usr/local/bin/docker-compose

echo "Installing docker compose bash completion..."
curl -L https://raw.githubusercontent.com/docker/compose/$(docker-compose version --short)/contrib/completion/bash/docker-compose -o /etc/bash_completion.d/docker-compose

echo "Enabling tuned..."
systemctl enable tuned
echo "Enabling powertop..."
systemctl enable powertop
chvt 1
exec < /dev/tty1 > /dev/tty1 2> /dev/tty1
exit
reboot
%end

%packages
@^kde-plasma-workspaces
%end

%anaconda
pwpolicy root --minlen=0 --minquality=1 --notstrict --nochanges --emptyok
pwpolicy user --minlen=0 --minquality=1 --notstrict --nochanges --emptyok
pwpolicy luks --minlen=0 --minquality=1 --notstrict --nochanges --emptyok
%end
